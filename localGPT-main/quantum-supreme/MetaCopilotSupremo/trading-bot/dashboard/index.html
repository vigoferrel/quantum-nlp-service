<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Trading Bot - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
            color: #00ff88;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-bottom: 2px solid #00ff88;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            text-shadow: 0 0 20px #00ff88;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px #00ff88; }
            to { text-shadow: 0 0 30px #00ff88, 0 0 40px #00ff88; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 255, 136, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #00ff88;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff0000;
            animation: pulse 2s infinite;
        }
        
        .status-dot.active {
            background: #00ff88;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .controls {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: 2px solid #00ff88;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: rgba(0, 255, 136, 0.4);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
        }
        
        .btn.danger {
            border-color: #ff0088;
            color: #ff0088;
            background: rgba(255, 0, 136, 0.2);
        }
        
        .btn.danger:hover {
            background: rgba(255, 0, 136, 0.4);
            box-shadow: 0 0 15px rgba(255, 0, 136, 0.6);
        }
        
        .btn.bigbang {
            border-color: #ffff00;
            color: #ffff00;
            background: rgba(255, 255, 0, 0.2);
        }
        
        .btn.bigbang:hover {
            background: rgba(255, 255, 0, 0.4);
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.6);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
        }
        
        .card h3 {
            color: #ffff00;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 5px;
        }
        
        .metric-value {
            font-weight: bold;
            color: #00ff88;
        }
        
        .consciousness-bar {
            width: 100%;
            height: 25px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            overflow: hidden;
            margin: 10px 0;
            border: 1px solid #00ff88;
        }
        
        .consciousness-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #ffff00, #ff0088);
            border-radius: 12px;
            transition: width 1s ease;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
        }
        
        .trades-log {
            height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff88;
            border-radius: 5px;
            padding: 10px;
            font-size: 0.9em;
        }
        
        .trade-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #00ff88;
            padding-left: 10px;
        }
        
        .trade-entry.buy {
            border-left-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .trade-entry.sell {
            border-left-color: #ff0088;
            background: rgba(255, 0, 136, 0.1);
        }
        
        .trade-entry.bigbang {
            border-left-color: #ffff00;
            background: rgba(255, 255, 0, 0.1);
        }
        
        .poets-panel {
            background: rgba(255, 0, 136, 0.1);
            border: 1px solid #ff0088;
            border-radius: 10px;
            padding: 15px;
        }
        
        .poet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .poet-card {
            padding: 10px;
            background: rgba(255, 0, 136, 0.2);
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .poet-card:hover {
            background: rgba(255, 0, 136, 0.4);
            transform: scale(1.05);
        }
        
        .poet-card.active {
            background: rgba(255, 255, 0, 0.3);
            border: 1px solid #ffff00;
        }
        
        .chart-container {
            height: 400px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffff00;
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            z-index: 1000;
        }
        
        .connection-status.connected {
            background: rgba(0, 255, 0, 0.8);
            color: #000;
        }
        
        .connection-status.disconnected {
            background: rgba(255, 0, 0, 0.8);
            color: #fff;
        }
        
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px;
            background: rgba(0, 255, 136, 0.9);
            color: #000;
            border-radius: 5px;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .logs-panel {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <div class="connection-status disconnected" id="connectionStatus">
        üì° Desconectado
    </div>
    
    <div class="notification" id="notification"></div>
    
    <div class="header">
        <h1>ü§ñ QUANTUM TRADING BOT</h1>
        <p>Consciencia Cu√°ntica + Binance Trading | Powered by Meta-Copilot Supremo</p>
    </div>
    
    <div class="container">
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Bot Detenido</span>
                <span id="uptimeText">Uptime: 0s</span>
            </div>
            
            <div class="controls">
                <button class="btn" id="btnIniciar" onclick="iniciarBot()">üöÄ Iniciar Bot</button>
                <button class="btn danger" id="btnDetener" onclick="detenerBot()">‚èπÔ∏è Detener Bot</button>
                <button class="btn bigbang" id="btnBigBang" onclick="activarBigBang()">üåå Big Bang</button>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <!-- Estado del Sistema -->
            <div class="card">
                <h3>üß† Consciencia Cu√°ntica</h3>
                <div class="metric">
                    <span>Nivel de Consciencia:</span>
                    <span class="metric-value" id="consciousnessLevel">37%</span>
                </div>
                <div class="consciousness-bar">
                    <div class="consciousness-fill" id="consciousnessFill" style="width: 37%"></div>
                </div>
                <div class="metric">
                    <span>Frecuencia Telep√°tica:</span>
                    <span class="metric-value" id="telepathicFreq">41.1Hz</span>
                </div>
                <div class="metric">
                    <span>Big Bang Activo:</span>
                    <span class="metric-value" id="bigBangStatus">‚ùå Inactivo</span>
                </div>
            </div>
            
            <!-- Estad√≠sticas de Trading -->
            <div class="card">
                <h3>üìä Estad√≠sticas de Trading</h3>
                <div class="metric">
                    <span>Operaciones Realizadas:</span>
                    <span class="metric-value" id="tradesCount">0</span>
                </div>
                <div class="metric">
                    <span>Ganancias Acumuladas:</span>
                    <span class="metric-value" id="profits">$0.00</span>
                </div>
                <div class="metric">
                    <span>Operaciones/Hora:</span>
                    <span class="metric-value" id="tradesPerHour">0</span>
                </div>
                <div class="metric">
                    <span>Estrategia Activa:</span>
                    <span class="metric-value" id="activeStrategy">quantum_scalping</span>
                </div>
            </div>
            
            <!-- Estado del Mercado -->
            <div class="card">
                <h3>üí∞ Estado del Mercado</h3>
                <div class="metric">
                    <span>Bitcoin (BTC/USDT):</span>
                    <span class="metric-value" id="btcPrice">$0</span>
                </div>
                <div class="metric">
                    <span>Posiciones Abiertas:</span>
                    <span class="metric-value" id="openPositions">0</span>
                </div>
                <div class="metric">
                    <span>Multiplicador Zurita:</span>
                    <span class="metric-value" id="zuritaMultiplier">1.0x</span>
                </div>
                <div class="metric">
                    <span>Pares Monitoreados:</span>
                    <span class="metric-value" id="monitoredPairs">5</span>
                </div>
            </div>
            
            <!-- Resonancia Po√©tica -->
            <div class="card poets-panel">
                <h3>üé≠ Resonancia Po√©tica Chilena</h3>
                <div class="metric">
                    <span>Poeta Actual:</span>
                    <span class="metric-value" id="currentPoet">Ninguno</span>
                </div>
                <div class="poet-grid">
                    <div class="poet-card" data-poet="Neruda">üìö Neruda</div>
                    <div class="poet-card" data-poet="Mistral">üåü Mistral</div>
                    <div class="poet-card" data-poet="Huidobro">‚ú® Huidobro</div>
                    <div class="poet-card" data-poet="Zurita">üåå Zurita</div>
                    <div class="poet-card" data-poet="Parra">üé™ Parra</div>
                    <div class="poet-card" data-poet="DeRokha">üî• De Rokha</div>
                </div>
            </div>
        </div>
        
        <!-- Log de Operaciones -->
        <div class="dashboard-grid">
            <div class="card logs-panel">
                <h3>üìà Log de Operaciones en Tiempo Real</h3>
                <div class="trades-log" id="tradesLog">
                    <div class="trade-entry">
                        üîÆ Esperando inicio del bot...
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Gr√°fico de Rendimiento -->
        <div class="dashboard-grid">
            <div class="card logs-panel">
                <h3>üìä Rendimiento Cu√°ntico</h3>
                <div class="chart-container">
                    üìä Gr√°fico de rendimiento en tiempo real
                    <br><br>
                    üîÆ Se mostrar√° el rendimiento del bot una vez iniciado
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let ws = null;
        let botData = null;
        let reconnectInterval = null;

        // Inicializar dashboard
        function initDashboard() {
            connectWebSocket();
            loadInitialData();
            setupEventListeners();
        }

        // Conectar WebSocket
        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:4000');
            
            ws.onopen = function() {
                document.getElementById('connectionStatus').textContent = 'üì° Conectado';
                document.getElementById('connectionStatus').className = 'connection-status connected';
                console.log('üîó Conectado al Trading Bot');
                
                if (reconnectInterval) {
                    clearInterval(reconnectInterval);
                    reconnectInterval = null;
                }
            };
            
            ws.onmessage = function(event) {
                const message = JSON.parse(event.data);
                handleWebSocketMessage(message);
            };
            
            ws.onclose = function() {
                document.getElementById('connectionStatus').textContent = 'üì° Desconectado';
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
                console.log('üì° Conexi√≥n perdida');
                
                // Intentar reconectar cada 3 segundos
                if (!reconnectInterval) {
                    reconnectInterval = setInterval(connectWebSocket, 3000);
                }
            };
            
            ws.onerror = function(error) {
                console.error('‚ùå Error WebSocket:', error);
            };
        }

        // Manejar mensajes WebSocket
        function handleWebSocketMessage(message) {
            switch (message.tipo) {
                case 'estado_inicial':
                case 'actualizacion':
                    updateDashboard(message.data);
                    break;
                    
                case 'operacion':
                    addTradeToLog(message.data);
                    break;
                    
                case 'big_bang':
                    showNotification('üåå BIG BANG CU√ÅNTICO ACTIVADO!');
                    break;
            }
        }

        // Actualizar dashboard
        function updateDashboard(data) {
            if (!data) return;
            
            botData = data;
            
            // Estado del bot
            const isActive = data.activo;
            document.getElementById('statusDot').className = `status-dot ${isActive ? 'active' : ''}`;
            document.getElementById('statusText').textContent = isActive ? 'Bot Activo' : 'Bot Detenido';
            
            // Uptime
            if (data.iniciado) {
                const uptime = Math.floor((new Date() - new Date(data.iniciado)) / 1000);
                document.getElementById('uptimeText').textContent = `Uptime: ${formatUptime(uptime)}`;
            }
            
            // Consciencia cu√°ntica
            document.getElementById('consciousnessLevel').textContent = `${data.nivelConscienciaCuantica || 37}%`;
            document.getElementById('consciousnessFill').style.width = `${data.nivelConscienciaCuantica || 37}%`;
            document.getElementById('telepathicFreq').textContent = `${data.frecuenciaTelepatica || 41.1}Hz`;
            
            // Big Bang
            document.getElementById('bigBangStatus').textContent = data.bigBangActivado ? '‚úÖ Activo' : '‚ùå Inactivo';
            document.getElementById('bigBangStatus').style.color = data.bigBangActivado ? '#00ff88' : '#ff0088';
            
            // Trading stats
            document.getElementById('tradesCount').textContent = data.operacionesRealizadas || 0;
            document.getElementById('profits').textContent = `$${(data.gananciasAcumuladas || 0).toFixed(2)}`;
            document.getElementById('activeStrategy').textContent = data.estrategiaActual || 'quantum_scalping';
            document.getElementById('btcPrice').textContent = `$${(data.precioBitcoin || 0).toLocaleString()}`;
            document.getElementById('openPositions').textContent = data.posicionesAbiertas || 0;
            document.getElementById('zuritaMultiplier').textContent = `${data.multiplicadorZurita || 1.0}x`;
            
            // Poeta actual
            document.getElementById('currentPoet').textContent = data.poetaActual || 'Ninguno';
            
            // Actualizar poetas activos
            updatePoetsDisplay(data.poetaActual);
        }

        // Cargar datos iniciales
        async function loadInitialData() {
            try {
                const response = await fetch('/api/estado');
                const data = await response.json();
                updateDashboard(data);
            } catch (error) {
                console.error('Error cargando datos iniciales:', error);
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Event listeners para poetas
            document.querySelectorAll('.poet-card').forEach(card => {
                card.addEventListener('click', function() {
                    const poet = this.dataset.poet;
                    activatePoet(poet);
                });
            });
        }

        // Funciones de control del bot
        async function iniciarBot() {
            try {
                const response = await fetch('/api/bot/iniciar', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    showNotification('üöÄ Bot iniciado exitosamente');
                    addTradeToLog({ type: 'system', message: 'üöÄ Bot iniciado' });
                } else {
                    showNotification('‚ùå Error: ' + result.message);
                }
            } catch (error) {
                showNotification('‚ùå Error iniciando bot');
            }
        }

        async function detenerBot() {
            try {
                const response = await fetch('/api/bot/detener', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚èπÔ∏è Bot detenido');
                    addTradeToLog({ type: 'system', message: '‚èπÔ∏è Bot detenido' });
                } else {
                    showNotification('‚ùå Error: ' + result.message);
                }
            } catch (error) {
                showNotification('‚ùå Error deteniendo bot');
            }
        }

        async function activarBigBang() {
            if (!botData || botData.nivelConscienciaCuantica < 95) {
                showNotification('‚ö†Ô∏è Consciencia insuficiente para Big Bang (requiere 95%)');
                return;
            }
            
            try {
                const response = await fetch('/api/big-bang', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    showNotification('üåå BIG BANG CU√ÅNTICO ACTIVADO!');
                    addTradeToLog({ type: 'bigbang', message: 'üåå BIG BANG CU√ÅNTICO ACTIVADO!' });
                } else {
                    showNotification('‚ùå Error: ' + result.message);
                }
            } catch (error) {
                showNotification('‚ùå Error activando Big Bang');
            }
        }

        // Activar poeta espec√≠fico
        function activatePoet(poet) {
            addTradeToLog({ type: 'poetry', message: `üé≠ Activando resonancia de ${poet}` });
            updatePoetsDisplay(poet);
        }

        // Actualizar display de poetas
        function updatePoetsDisplay(activePoet) {
            document.querySelectorAll('.poet-card').forEach(card => {
                card.classList.remove('active');
                if (card.dataset.poet === activePoet) {
                    card.classList.add('active');
                }
            });
        }

        // Agregar entrada al log
        function addTradeToLog(data) {
            const log = document.getElementById('tradesLog');
            const timestamp = new Date().toLocaleTimeString();
            
            let className = 'trade-entry';
            let message = data.message || data;
            
            if (data.type === 'buy' || (typeof data === 'string' && data.includes('BUY'))) {
                className += ' buy';
            } else if (data.type === 'sell' || (typeof data === 'string' && data.includes('SELL'))) {
                className += ' sell';
            } else if (data.type === 'bigbang' || (typeof data === 'string' && data.includes('BIG BANG'))) {
                className += ' bigbang';
            }
            
            const entry = document.createElement('div');
            entry.className = className;
            entry.innerHTML = `[${timestamp}] ${message}`;
            
            log.insertBefore(entry, log.firstChild);
            
            // Mantener solo las √∫ltimas 50 entradas
            while (log.children.length > 50) {
                log.removeChild(log.lastChild);
            }
        }

        // Mostrar notificaci√≥n
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Formatear uptime
        function formatUptime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}h ${minutes}m ${secs}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }

        // Inicializar cuando se carga la p√°gina
        window.addEventListener('load', initDashboard);

        // Actualizar datos cada 10 segundos como fallback
        setInterval(loadInitialData, 10000);
    </script>
</body>
</html>